<!doctype html>
<html>
    <head>
        <title>读取本地文件</title>
    </head>
    <body>
        <div id="content"></div>
        <div id="loading">正在加载...</div>

        <script>
            // 页面加载状态标志
            let isPageLoaded = false;

            // 获取 DOM 元素
            const contentDiv = document.getElementById("content");
            const loadingDiv = document.getElementById("loading");

            // 异步读取文件函数
            async function loadFile(filePath) {
                try {
                    // 使用 fetch 读取文件
                    const response = await fetch(filePath);
                    if (!response.ok) {
                        throw new Error("无法读取文件");
                    }

                    const text = await response.text();

                    // 显示文件内容
                    contentDiv.textContent = text;

                    // 隐藏加载提示
                    loadingDiv.style.display = "none";

                    // 设置页面加载完成
                    isPageLoaded = true;
                    console.log("页面加载完成，文件内容已显示");

                    // 触发自定义的页面加载完成事件
                    const loadEvent = new Event("pageFullyLoaded");
                    document.dispatchEvent(loadEvent);
                } catch (error) {
                    console.error("读取文件时出错:", error);
                    contentDiv.textContent = "读取文件失败";
                    loadingDiv.style.display = "none";
                }
            }

            // 检查页面加载状态的函数
            function checkPageLoadStatus() {
                return isPageLoaded;
            }

            // 监听自定义的页面加载完成事件
            document.addEventListener("pageFullyLoaded", function () {
                console.log("页面已完全加载，可以执行后续操作");
            });

            // 调用函数，传入本地文件路径
            // 注意：由于浏览器安全限制，fetch 访问本地文件可能需要服务器环境
            loadFile("file:///etc/passwd");
        </script>
    </body>
</html>
